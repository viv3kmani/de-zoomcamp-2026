version: 2

models:
  - name: fact_trips
    description: "Consolidated fact table containing records for both Yellow and Green taxi trips, enriched with location and zone details."
    columns:
      - name: service_type
        data_type: string
        description: "Source dataset flag: 'yellow' or 'green'."

      - name: trip_id
        data_type: string
        description: "Unique identifier for each taxi trip (usually a hash of record attributes)."

      - name: vendor_id
        data_type: int64
        description: "A code indicating the TPEP/LPEP provider that provided the record. 1= Creative Mobile Technologies, LLC; 2= VeriFone Inc."

      - name: rate_code_id
        data_type: int64
        description: "The final rate code in effect at the end of the trip. 1=Standard, 2=JFK, 3=Newark, etc."

      - name: pickup_location_id
        data_type: int64
        description: "TLC Taxi Zone in which the taximeter was engaged."

      - name: dropoff_location_id
        data_type: int64
        description: "TLC Taxi Zone in which the taximeter was disengaged."

      - name: pickup_datetime
        data_type: timestamp
        description: "The date and time when the meter was engaged."

      - name: dropoff_datetime
        data_type: timestamp
        description: "The date and time when the meter was disengaged."

      - name: passenger_count
        data_type: int64
        description: "The number of passengers in the vehicle. This is a driver-entered value."

      - name: trip_distance
        data_type: numeric
        description: "The elapsed trip distance in miles reported by the taximeter."

      - name: fare_amount
        data_type: numeric
        description: "The time-and-distance fare calculated by the meter."

      - name: tip_amount
        data_type: numeric
        description: "Tip amount â€“ automatically populated for credit card payments. Cash tips are not included."

      - name: total_amount
        data_type: numeric
        description: "The total amount charged to passengers. Does not include cash tips."

      - name: payment_type
        data_type: int64
        description: "Numeric code signifying how the passenger paid. 1= Credit card, 2= Cash, 3= No charge, 4= Dispute."
        tests:
          - accepted_values:
              values: "{{var('payment_type_values')}}"
              severity: warn

      - name: pickup_borough
        data_type: string
        description: "Borough corresponding to the pickup_location_id."

      - name: pickup_zone
        data_type: string
        description: "Neighborhood zone corresponding to the pickup_location_id."

  - name: fact_monthly_zone_revenue
    description: "Aggregated table calculating monthly financial performance and trip statistics grouped by pickup zone and service type."
    columns:
      - name: pickup_zone
        data_type: string
        description: "The neighborhood zone where the trips originated."

      - name: revenue_month
        data_type: date
        description: "The month and year of the trip start date, truncated to the first of the month."

      - name: revenue_monthly_total_amount
        data_type: numeric
        description: "Sum of total_amount (fares, fees, and tips) for the zone and month."

      - name: total_monthly_trips
        data_type: int64
        description: "Total count of trips recorded for this zone and month."

      - name: avg_monthly_passenger_count
        data_type: float64
        description: "The average number of passengers per trip for this zone and month."
